{% extends "base.html" %}
{% load static %}

{% block body %}

<div class="bg-frame-50 dark:bg-gray-900 min-h-screen py-28 sm:py-32">
    <div class="container mx-auto px-4">

        <div class="max-w-4xl mx-auto">

            <div class="text-center mb-6 sm:mb-10">
                <h1 class="text-2xl sm:text-3xl font-bold text-pr-900 dark:text-white font-se">
                    Choose Your Ticket Package
                </h1>
                <p class="text-gray-500 dark:text-gray-400 mt-2">
                    Select the appropriate ticket category based on nationality to proceed with booking.
                </p>
            </div>


            <div id="nationality-selector">
                <div class="flex flex-col md:flex-row justify-center items-stretch gap-8">

                    <div onclick="selectNationality('domestik')"
                        class="w-full md:w-80 p-8 bg-white dark:bg-gray-800 rounded-2xl shadow-lg border-2 border-transparent hover:border-pr-900 cursor-pointer transition-all duration-300 transform hover:-translate-y-1 flex flex-col">
                        <div class="flex items-center mb-6">
                            <div class="p-3 rounded-full bg-blue-100 text-blue-600 mr-4 h-12 w-12">
                                <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                                    text-rendering="geometricPrecision" image-rendering="optimizeQuality"
                                    fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 512 512">
                                    <g fill-rule="nonzero">
                                        <path fill="#999"
                                            d="M256 0c70.68 0 134.69 28.66 181.01 74.99C483.34 121.31 512 185.32 512 256c0 70.68-28.66 134.69-74.99 181.01C390.69 483.34 326.68 512 256 512c-70.68 0-134.69-28.66-181.01-74.99C28.66 390.69 0 326.68 0 256c0-70.68 28.66-134.69 74.99-181.01C121.31 28.66 185.32 0 256 0z" />
                                        <path fill="#fff"
                                            d="M256 19.48c65.3 0 124.46 26.48 167.25 69.27l1.09 1.18c42.14 42.71 68.18 101.37 68.18 166.06 0 65.31-26.5 124.46-69.29 167.25l-1.18 1.09c-42.73 42.16-101.4 68.19-166.05 68.19-65.23 0-124.37-26.51-167.18-69.33-42.84-42.74-69.33-101.89-69.33-167.2 0-65.31 26.48-124.45 69.27-167.24C131.55 45.96 190.7 19.48 256 19.48z" />
                                        <path fill="red"
                                            d="M472.41 256.42H39.6v-.43c0-119.51 96.89-216.4 216.4-216.4 119.52 0 216.41 96.89 216.41 216.4v.43z" />
                                    </g>
                                </svg>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Domestic Tourist</h3>
                        </div>
                        <div class="text-start mb-6">
                            <span class="text-2xl font-bold font-se  text-pr-900 dark:text-white">Rp 20K - 30K</span>
                            <span class="text-lg font-medium text-gray-500 dark:text-gray-400">/person</span>
                        </div>
                        <ul class="space-y-3 text-gray-600 dark:text-gray-300 mb-8">
                            <li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0"
                                    fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd"
                                        d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                        clip-rule="evenodd"></path>
                                </svg>Child: Rp 20.000</li>
                            <li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0"
                                    fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd"
                                        d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                        clip-rule="evenodd"></path>
                                </svg>Adult: Rp 30.000</li>
                            <li class="fflex items-center text-sm mt-5 sm:mt-5 font-se">
                                Special Tickets for Indonesian Citizens*
                            </li>
                        </ul>
                        <div class="mt-auto">
                            <div
                                class="w-full bg-pr-900 text-white font-medium py-3 px-4 rounded-lg text-lg text-center transition-all">
                                Select Tickets
                            </div>
                        </div>
                    </div>

                    <div onclick="selectNationality('asing')"
                        class="w-full md:w-80 p-8 bg-white dark:bg-gray-800 rounded-2xl shadow-lg border-2 border-transparent hover:border-pr-900 cursor-pointer transition-all duration-300 transform hover:-translate-y-1 flex flex-col">
                        <div class="flex items-center mb-6">
                            <div class="p-3 rounded-full bg-green-100 text-green-600 mr-4 h-12 w-12">
                                <?xml version="1.0" encoding="utf-8"?>
                                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                                    xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 122.88 122.88">
                                    <g>
                                        <path fill-rule="evenodd" clip-rule="evenodd" fill="#2394E0"
                                            d="M61.44,0c33.93,0,61.44,27.51,61.44,61.44c0,33.93-27.51,61.44-61.44,61.44C27.51,122.88,0,95.37,0,61.44 C0,27.51,27.51,0,61.44,0L61.44,0L61.44,0z" />

                                        <path fill-rule="evenodd" clip-rule="evenodd" fill="#A1E367"
                                            d="M11.76,93.18c-3.62-5.49-6.33-11.64-7.92-18.23l10.82,5.22l0.06,3.23c0,1.19-2.02,3.71-2.67,4.67L11.76,93.18 L11.76,93.18L11.76,93.18z M78.31,6.5c20.62,6.85,36.09,25,39.07,47.1l-1.95-0.21c-0.35,1.5-0.67,1.53-0.67,3.33c0,1.59,2,2.65,2,6 c0,0.9-2.11,2.69-2.2,3.01l-3.13-3.67v4.67l-0.47-0.02l-0.84-8.62l-1.75,0.55l-2.08-6.41l-6.85,7.16l-0.08,5.24l-2.24,1.5 l-2.38-13.44l-1.42,1.04l-3.22-4.35l-4.81,0.14l-1.84-2.11l-1.89,0.52l-3.71-4.25l-0.72,0.49l2.3,5.88h2.67v-1.33l1.33,0 c0.96,2.66,2,1.08,2,2.67c0,5.55-6.85,9.63-11.34,10.67c0.24,1,0.15,2,1.33,2c2.51,0,1.26-0.44,4-0.67 c-0.13,5.67-6.5,12.44-9.22,16.65l1.22,8.69c0.32,1.89-3.92,3.88-5.36,6.01l0.69,3.33l-1.95,0.79c-0.34,3.42-3.66,7.21-7.39,7.21 h-4c0-4.68-3.34-11.37-3.34-14.68c0-2.81,1.33-3.19,1.33-6.67c0-3.22-3.33-7.83-3.33-8.67v-5.34H45.4c-0.4-1.49-0.15-2-2-2h-0.67 c-2.91,0-2.42,1.33-5.34,1.33h-2.67c-2.41,0-6.67-7.72-6.67-8.67v-8c0-3.45,3.16-7.21,5.34-8.67v-3.33l3-3.05l1.67-0.28 c3.58,0,3.15-2,5.34-2l6,0v4.67l6.6,2.82l0.62-2.85c2.99,0.7,3.77,2.03,7.45,2.03h1.33c2.53,0,2.67-3.36,2.67-6l-5.34,0.53 l-2.33-5.06l-2.31,0.61c0.42,1.81,0.64,1.06,0.64,2.59c0,0.9-0.74,1-1.34,1.33l-2.31-5.86l-4.97-3.55l-0.66,0.65l4.23,4.45 c-0.56,1.6-0.63,6.21-2.96,2.98l2.18-1.05l-5.44-5.7l-3.26,1.27l-3.22,3.08c-0.34,2.48-1.01,3.73-3.61,3.73 c-1.73,0-0.69-0.45-3.34-0.67v-6.67h6l-1.95-4.44l-0.72,0.44v-1.34l9.75-4.49c-0.18-1.4-0.41-0.65-0.41-2.18 c0-0.09,0.65-1.32,0.67-1.34l2.52,1.57l-0.6-2.87l-3.89,0.8l-0.72-3.49c3.08-1.62,9.87-7.34,12.03-7.34l2,0 c2.11,0,7.75,2.08,8.67,3.33l-5.35-0.54l3.97,3.27l0.38-1.4l2.96-0.81l0.04-1.85h1.34v2L78.31,6.5L78.31,6.5L78.31,6.5z" />
                                    </g>
                                </svg>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Foreigner Tourist</h3>
                        </div>
                        <div class="text-start mb-6">
                            <span class="text-2xl font-bold font-se  text-pr-900 dark:text-white">Rp 40K - 75K</span>
                            <span class="text-lg font-medium text-gray-500 dark:text-gray-400">/person</span>
                        </div>
                        <ul class="space-y-3 text-gray-600 dark:text-gray-300 mb-8">
                            <li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0"
                                    fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd"
                                        d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                        clip-rule="evenodd"></path>
                                </svg>Child: Rp 40.000</li>
                            <li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0"
                                    fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd"
                                        d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                        clip-rule="evenodd"></path>
                                </svg>Adult: Rp 75.000</li>
                            <li class="flex items-center text-sm mt-5 sm:mt-5 font-se">
                                Special Tickets for Foreign Nationals*
                            </li>
                        </ul>
                        <div class="mt-auto">
                            <div
                                class="w-full bg-pr-900 text-white font-medium py-3 px-4 rounded-lg text-lg text-center transition-all">
                                Select Tickets
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="ticket-selector"
                class="hidden max-w-3xl mx-auto bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 sm:p-8 lg:p-10 mt-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-200 font-se ">Select Number of Tickets
                    </h2>
                    <button onclick="changeNationality()" class="text-sm text-pr-900 hover:underline font-se">
                        Change Category
                    </button>
                </div>

                <div id="domestik-tickets" class="space-y-4">
                    <div class="flex justify-between items-center p-4 bg-gray-50 dark:bg-gray-700/50 rounded-2xl">
                        <div>
                            <p class="font-semibold text-gray-800 dark:text-gray-200">Adult</p>
                            <p class="text-sm text-gray-600 dark:text-gray-300">Rp 30.000</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button data-type="adult" data-action="decrement"
                                class="quantity-btn w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 text-lg font-bold text-pr-900 font-se">-</button>
                            <span id="adult-domestik-count"
                                class="w-8 text-center text-lg font-semibold text-pr-900 font-se">0</span>
                            <button data-type="adult" data-action="increment"
                                class="quantity-btn w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 text-lg font-bold text-pr-900 font-se">+</button>
                        </div>
                    </div>
                    <div class="flex justify-between items-center p-4 bg-gray-50 dark:bg-gray-700/50 rounded-2xl">
                        <div>
                            <p class="font-semibold text-gray-800 dark:text-gray-200">Child</p>
                            <p class="text-sm text-gray-600 dark:text-gray-300">Rp 20.000</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button data-type="child" data-action="decrement"
                                class="quantity-btn w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 text-lg font-bold text-pr-900 font-se">-</button>
                            <span id="child-domestik-count"
                                class="w-8 text-center text-lg font-semibold text-pr-900 font-se">0</span>
                            <button data-type="child" data-action="increment"
                                class="quantity-btn w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 text-lg font-bold text-pr-900 font-se">+</button>
                        </div>
                    </div>
                </div>

                <div id="asing-tickets" class="space-y-4">
                    <div class="flex justify-between items-center p-4 bg-gray-50 dark:bg-gray-700/50 rounded-2xl">
                        <div>
                            <p class="font-semibold text-gray-800 dark:text-gray-200">Adult</p>
                            <p class="text-sm text-gray-600 dark:text-gray-300">Rp 75.000</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button data-type="adult" data-action="decrement"
                                class="quantity-btn w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 text-lg font-bold text-pr-900 font-se">-</button>
                            <span id="adult-asing-count"
                                class="w-8 text-center text-lg font-semibold text-pr-900 font-se">0</span>
                            <button data-type="adult" data-action="increment"
                                class="quantity-btn w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 text-lg font-bold text-pr-900 font-se">+</button>
                        </div>
                    </div>
                    <div class="flex justify-between items-center p-4 bg-gray-50 dark:bg-gray-700/50 rounded-2xl">
                        <div>
                            <p class="font-semibold text-gray-800 dark:text-gray-200">Child</p>
                            <p class="text-sm text-gray-600 dark:text-gray-300">Rp 40.000</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button data-type="child" data-action="decrement"
                                class="quantity-btn w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 text-lg font-bold text-pr-900 font-se">-</button>
                            <span id="child-asing-count"
                                class="w-8 text-center text-lg font-semibold text-pr-900 font-se">0</span>
                            <button data-type="child" data-action="increment"
                                class="quantity-btn w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 text-lg font-bold text-pr-900 font-se">+</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="order-details"
                class="hidden max-w-3xl mx-auto bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 sm:p-8 lg:p-10 mt-8">
                <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-6 font-se">Complete your data</h2>
                <form id="payment-form" method="POST" action="">
                    {% csrf_token %}
                    <input type="hidden" name="nationality" id="input-nationality">
                    <input type="hidden" name="adult_tickets" id="input-adult-tickets">
                    <input type="hidden" name="child_tickets" id="input-child-tickets">
                    <input type="hidden" name="total_price" id="input-total-price">

                    <div class="space-y-4">
                        <div>
                            <label for="full_name"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 font-se">
                                Full Name
                            </label>
                            <input type="text" name="full_name" id="full_name" required
                                class="shadow-xs bg-gray-20 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-pr-900 focus:border-pt-900 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 dark:shadow-xs-light"
                                placeholder="Enter your full name">
                        </div>
                        <div>
                            <label for="email"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 font-se">
                                Email
                            </label>
                            <input type="email" name="email" id="email" required
                                class="shadow-xs bg-gray-20 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-pr-900 focus:border-pt-900 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 dark:shadow-xs-light"
                                placeholder="Enter your email">
                        </div>
                        <div>
                            <label for="phone_number"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 font-se">
                                Phone Number / WhatsApp
                            </label>
                            <input type="tel" name="phone_number" id="phone_number" required
                                class="shadow-xs bg-gray-20 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-pr-900 focus:border-pt-900 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 dark:shadow-xs-light"
                                placeholder="Enter your phone number">
                        </div>
                    </div>

                    <div id="summary" class="mt-6 border-t border-gray-200 dark:border-gray-700 pt-6 space-y-2"></div>

                    <div
                        class="flex justify-between items-center mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                        <p class="text-lg font-medium text-gray-900 dark:text-white font-se">Payment amount</p>
                        <p id="total-price" class="text-xl font-bold text-pr-900 dark:text-white font-se">Rp 0</p>
                    </div>

                    <div class="mt-8">
                        <button type="submit" id="pay-button" disabled
                            class="w-full bg-pr-900 text-white font-medium py-4 px-4 rounded-lg text-lg hover:opacity-90 transition-all disabled:bg-gray-400 disabled:cursor-not-allowed">
                            Proceed to Payment
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Definisi semua elemen
        const nationalitySelector = document.getElementById('nationality-selector');
        const ticketSelector = document.getElementById('ticket-selector');
        const orderDetails = document.getElementById('order-details');
        const domestikTicketsDiv = document.getElementById('domestik-tickets');
        const asingTicketsDiv = document.getElementById('asing-tickets');
        const payButton = document.getElementById('pay-button');
        const summaryDiv = document.getElementById('summary');
        const totalPriceEl = document.getElementById('total-price');
        const inputNationality = document.getElementById('input-nationality');
        const inputAdultTickets = document.getElementById('input-adult-tickets');
        const inputChildTickets = document.getElementById('input-child-tickets');
        const inputTotalPrice = document.getElementById('input-total-price');

        // Data harga
        const ticketPrices = {
            domestik: { adult: 30000, child: 20000 },
            asing: { adult: 75000, child: 40000 }
        };

        // Variabel untuk menyimpan status
        let currentNationality = null;
        let ticketCounts = { adult: 0, child: 0 };

        // Fungsi untuk memilih kewarganegaraan
        window.selectNationality = (type, selectedCardElement) => {
            currentNationality = type;

            //  card yang aktif
            document.querySelectorAll('.nationality-card').forEach(card => {
                card.classList.remove('ring-2', 'ring-pr-900', 'ring-offset-2', 'dark:ring-offset-gray-900');
            });
            if (selectedCardElement) {
                selectedCardElement.classList.add('ring-2', 'ring-pr-900', 'ring-offset-2', 'dark:ring-offset-gray-900');
            }


            setTimeout(() => {
                nationalitySelector.style.display = 'none';
                ticketSelector.style.display = 'block';
                orderDetails.style.display = 'block';
            }, 200);

            //  untuk menampilkan harga 
            if (type === 'domestik') {
                domestikTicketsDiv.style.display = 'block';
                asingTicketsDiv.style.display = 'none';
            } else {
                domestikTicketsDiv.style.display = 'none';
                asingTicketsDiv.style.display = 'block';
            }

            ticketCounts = { adult: 0, child: 0 };
            updateSummary();
        };

        // Fungsi untuk kembali ke pemilihan kategori
        window.changeNationality = () => {
            currentNationality = null;
            ticketCounts = { adult: 0, child: 0 };

            document.querySelectorAll('.nationality-card').forEach(card => {
                card.classList.remove('ring-2', 'ring-pr-900', 'ring-offset-2', 'dark:ring-offset-gray-900');
            });

            nationalitySelector.style.display = 'block';
            ticketSelector.style.display = 'none';
            orderDetails.style.display = 'none';
            updateSummary();
        };

        // Fungsi untuk mengubah jumlah tiket
        const updateQuantity = (type, action) => {
            if (!currentNationality) return;
            if (action === 'increment') {
                ticketCounts[type]++;
            } else if (action === 'decrement' && ticketCounts[type] > 0) {
                ticketCounts[type]--;
            }
            updateSummary();
        };

        // Fungsi untuk memperbarui tampilan ringkasan dan total
        const updateSummary = () => {
            if (!currentNationality) {
                summaryDiv.innerHTML = '';
                totalPriceEl.textContent = 'Rp 0';
                payButton.disabled = true;
                return;
            }

            const prices = ticketPrices[currentNationality];
            let total = 0;
            let summaryHtml = '';

            document.getElementById(`adult-${currentNationality}-count`).textContent = ticketCounts.adult;
            document.getElementById(`child-${currentNationality}-count`).textContent = ticketCounts.child;

            if (ticketCounts.adult > 0) {
                const subtotal = ticketCounts.adult * prices.adult;
                total += subtotal;
                summaryHtml += `<div class="flex justify-between text-sm text-gray-600 dark:text-gray-300"><p>${ticketCounts.adult} x Adult (${currentNationality})</p><p>Rp ${subtotal.toLocaleString('id-ID')}</p></div>`;
            }
            if (ticketCounts.child > 0) {
                const subtotal = ticketCounts.child * prices.child;
                total += subtotal;
                summaryHtml += `<div class="flex justify-between text-sm text-gray-600 dark:text-gray-300"><p>${ticketCounts.child} x Child (${currentNationality})</p><p>Rp ${subtotal.toLocaleString('id-ID')}</p></div>`;
            }

            summaryDiv.innerHTML = summaryHtml;
            totalPriceEl.textContent = `Rp ${total.toLocaleString('id-ID')}`;
            payButton.disabled = total === 0;

            inputNationality.value = currentNationality;
            inputAdultTickets.value = ticketCounts.adult;
            inputChildTickets.value = ticketCounts.child;
            inputTotalPrice.value = total;
        };

        // Menambahkan event listener ke semua tombol kuantitas
        document.querySelectorAll('.quantity-btn').forEach(button => {
            button.addEventListener('click', () => {
                const type = button.dataset.type;
                const action = button.dataset.action;
                updateQuantity(type, action);
            });
        });

        // Event listener untuk form submission
        document.getElementById('payment-form').addEventListener('submit', function (event) {
            if (ticketCounts.adult === 0 && ticketCounts.child === 0) {
                alert('Please select the number of tickets first.');
                event.preventDefault();
            }
        });

    });
</script>

{% endblock body%}